<%- include('sidebar.ejs') %>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Inventory Management</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .dashboard-card { min-width: 220px; }
    .badge-instock { background: #d1e7dd; color: #198754; }
    .badge-lowstock { background: #fff3cd; color: #ffc107; }
    .badge-outstock { background: #f8d7da; color: #dc3545; }
    .table-actions button, .table-actions a { margin-right: 0.3rem; }
  </style>
</head>
<body class="bg-light">
<div class="container py-4">
  <h2 class="mb-4 fw-bold">Inventory Management</h2>
  <!-- Dashboard Cards -->
  <div class="row mb-4">
    <div class="col dashboard-card">
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <div class="fs-4 fw-bold"><%= totalItems %></div>
          <div>Total Items</div>
          <small class="text-secondary">All registered supplies</small>
        </div>
      </div>
    </div>
    <div class="col dashboard-card">
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <div class="fs-4 fw-bold text-warning"><%= lowStockItems %></div>
          <div>Low Stock Items</div>
          <small class="text-warning">Needs attention soon</small>
        </div>
      </div>
    </div>
    <div class="col dashboard-card">
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <div class="fs-4 fw-bold text-danger"><%= outOfStockItems %></div>
          <div>Out of Stock</div>
          <small class="text-danger">Critical, reorder immediately</small>
        </div>
      </div>
    </div>
    <div class="col dashboard-card">
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <div class="fs-4 fw-bold text-success"><%= recentAdditions %></div>
          <div>Recent Additions</div>
          <small class="text-secondary">In the last 7 days</small>
        </div>
      </div>
    </div>
  </div>
  <!-- Filters -->
  <div class="card mb-3 p-3 shadow-sm">
    <form class="row g-2 align-items-center">
      <div class="col-md-2">
        <input type="text" class="form-control" placeholder="Item name">
      </div>
      <div class="col-md-2">
        <input type="text" class="form-control" placeholder="Category">
      </div>
      <div class="col-md-2">
        <input type="number" class="form-control" placeholder="Stock level">
      </div>
      <div class="col-md-2">
        <input type="text" class="form-control" placeholder="Unit (pcs, bottles)">
      </div>
      <div class="col-md-2">
        <select class="form-select">
          <option>In Stock</option>
          <option>Low Stock</option>
          <option>Out of Stock</option>
        </select>
      </div>
      <div class="col-md-2">
        <a href="/inventory/new" class="btn btn-success w-100">+ Add Item</a>
      </div>
    </form>
  </div>
  <div class="row mb-3">
    <div class="col-md-6 mb-2 mb-md-0">
      <input type="text" class="form-control" placeholder="Search items by name...">
    </div>
    <div class="col-md-3 mb-2 mb-md-0">
      <select class="form-select">
        <option>All Statuses</option>
        <option>In Stock</option>
        <option>Low Stock</option>
        <option>Out of Stock</option>
      </select>
    </div>
    <div class="col-md-3 d-flex">
      <select class="form-select me-2">
        <option>All Categories</option>
        <option>Medicines</option>
        <option>Medical Devices</option>
        <option>Surgical Supplies</option>
        <option>Lab Supplies</option>
      </select>
      <button class="btn btn-outline-secondary">Refresh</button>
    </div>
  </div>
  <!-- Inventory Table -->
  <div class="table-responsive">
    <table class="table table-bordered align-middle bg-white shadow-sm">
      <thead class="table-light">
        <tr>
          <th>Item ID</th>
          <th>Item Name</th>
          <th>Category</th>
          <th>Stock Level</th>
          <th>Unit</th>
          <th>Status</th>
          <th>Last Updated</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% inventory.forEach(item => { %>
        <tr>
          <td><%= item._id %></td>
          <td><%= item.name %></td>
          <td><%= item.category %></td>
          <td><%= item.stock %></td>
          <td><%= item.unit %></td>
          <td>
            <% if(item.status === 'In Stock'){ %>
              <span class="badge badge-instock">In Stock</span>
            <% } else if(item.status === 'Low Stock'){ %>
              <span class="badge badge-lowstock">Low Stock</span>
            <% } else { %>
              <span class="badge badge-outstock">Out of Stock</span>
            <% } %>
          </td>
          <td><%= item.last_updated ? item.last_updated.toLocaleDateString() : '' %></td>
          <td class="table-actions">
            <a href="/inventory/<%= item._id %>/edit" class="btn btn-outline-primary btn-sm" title="Edit">
              <i class="bi bi-pencil-square"></i>
            </a>
            <form action="/inventory/<%= item._id %>?_method=DELETE" method="POST" style="display:inline;">
              <button type="submit" class="btn btn-outline-danger btn-sm" title="Delete">
                <i class="bi bi-trash"></i>
              </button>
            </form>
          </td>
        </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
<!-- Bootstrap Icons CDN -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
</body>
</html>