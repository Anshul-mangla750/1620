<!DOCTYPE html>
<html>
<head>
  <title>Bed Management Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .occupied-badge { background-color: #f8d7da; color: #721c24; }
    .available-badge { background-color: #d4edda; color: #155724; }
    .critical { color: red; font-weight: bold; }
    .stable { color: green; font-weight: bold; }
    .card-outline { border-left: 5px solid #0d6efd; }
  </style>
</head>
<body class="bg-light">

<div class="container mt-4">
  <h2 class="fw-bold mb-3">Bed Management</h2>

  <!-- Stats -->
  <div class="row text-center mb-4">
    <div class="col"><div class="card card-outline"><div class="card-body"><h5>Total Beds</h5><p class="fs-4 fw-bold"><%= stats.total %></p></div></div></div>
    <div class="col"><div class="card card-outline"><div class="card-body"><h5>Occupied</h5><p class="fs-4 text-danger fw-bold"><%= stats.occupied %></p></div></div></div>
    <div class="col"><div class="card card-outline"><div class="card-body"><h5>Available</h5><p class="fs-4 text-success fw-bold"><%= stats.available %></p></div></div></div>
    <div class="col"><div class="card card-outline"><div class="card-body"><h5>Occupancy</h5><p class="fs-4 text-primary fw-bold"><%= stats.occupancyRate %>%</p></div></div></div>
  </div>

  <!-- Search & Filter -->
  <form class="row mb-3" method="GET" action="/beds">
    <div class="col-md-6">
      <input type="text" class="form-control" name="search" placeholder="Search..." value="<%= filters.search %>">
    </div>
    <div class="col-md-3">
      <select class="form-select" name="ward">
        <option <%= filters.ward === 'All' ? 'selected' : '' %>>All</option>
        <option <%= filters.ward === 'ICU' ? 'selected' : '' %>>ICU</option>
        <option <%= filters.ward === 'General Ward' ? 'selected' : '' %>>General Ward</option>
        <option <%= filters.ward === 'OPD' ? 'selected' : '' %>>OPD</option>
      </select>
    </div>
    <div class="col-md-3">
      <select class="form-select" name="status">
        <option <%= filters.status === 'All' ? 'selected' : '' %>>All</option>
        <option <%= filters.status === 'available' ? 'selected' : '' %>>Available</option>
        <option <%= filters.status === 'occupied' ? 'selected' : '' %>>Occupied</option>
      </select>
    </div>
    <div class="col-12 text-end mt-2">
      <button class="btn btn-primary">Apply Filters</button>
    </div>
  </form>

  <!-- Bed Cards -->
  <% beds.forEach(bed => { %>
    <div class="card mb-3">
      <div class="card-body d-flex justify-content-between">
        <div>
          <h5><%= bed.bedId %> 
            <% if (bed.status === 'occupied') { %>
              <span class="badge occupied-badge">Occupied</span>
            <% } else { %>
              <span class="badge available-badge">Available</span>
            <% } %>
          </h5>
          <p><%= bed.ward %> â€“ <%= bed.floor %>, <%= bed.room %></p>

          <% if (bed.status === 'occupied') { %>
            <p> Patient: <%= bed.patient.name %> (ID: <%= bed.patient.id %>)</p>
            <p> Doctor: <%= bed.doctor %></p>
            <p> Condition: <%= bed.condition === 'Critical' ? '<span class="critical">Critical</span>' : '<span class="stable">Stable</span>' %></p>
            <% if (bed.dischargeDate) { %>
              <p> Discharge: <%= bed.dischargeDate.toISOString().split('T')[0] %></p>
            <% } %>
          <% } else { %>
            <p class="text-success">Bed is available for allocation.</p>
          <% } %>
        </div>
        <div>
          <% if (bed.status === 'occupied') { %>
            <form action="/beds/discharge/<%= bed._id %>" method="POST">
              <button class="btn btn-outline-danger">Discharge</button>
            </form>
          <% } else { %>
            <form action="/beds/allocate/<%= bed._id %>" method="POST">
              <input type="hidden" name="patientName" value="Test Patient">
              <input type="hidden" name="patientId" value="TEMP<%= bed._id %>">
              <input type="hidden" name="doctor" value="Dr. Test">
              <input type="hidden" name="condition" value="Stable">
              <input type="hidden" name="dischargeDate" value="<%= new Date().toISOString().split('T')[0] %>">
              <button class="btn btn-success">Allocate</button>
            </form>
          <% } %>
        </div>
      </div>
    </div>
  <% }) %>
</div>

</body>
</html>
